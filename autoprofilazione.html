<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chi sei tu?</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
</head>
<body class="bg-gray-50 text-gray-900 flex items-center justify-center min-h-screen" style="font-family: 'Inter', sans-serif;">
  <div class="w-full max-w-md bg-white p-6 rounded-xl shadow-lg" id="app">
    <div class="mb-6">
      <div class="flex justify-between items-center mb-2 text-sm text-gray-600">
        <span id="stepText">Step 1 di 5</span>
        <span id="stepPercent">0%</span>
      </div>
      <div class="h-2 bg-gray-200 rounded">
        <div id="progressBar" class="h-2 bg-blue-600 rounded transition-all" style="width:0%"></div>
      </div>
    </div>
    <div class="relative overflow-hidden">
      <div id="stepsContainer">
        <!-- steps generated by JS -->
      </div>
      <div id="summary" class="hidden text-center space-y-4">
        <p id="summaryText" class="text-lg font-semibold"></p>
        <a href="form.html" class="inline-block bg-blue-600 text-white px-4 py-2 rounded">Continua</a>
      </div>
    </div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const formData = JSON.parse(localStorage.getItem('mateForm')) || {};
    const answers = [];
    const stepsData = [
      {question: 'Cibo preferito?', left: {emoji:'\uD83C\uDF54', value:'junk_food'}, right:{emoji:'\uD83E\uDD57', value:'healthy_food'}},
      {question: 'Ordine in casa?', left:{emoji:'\uD83D\uDE31', value:'caos'}, right:{emoji:'\uD83E\uDDFC', value:'order_lover'}},
      {question: 'Quando sei attivo?', left:{emoji:'\u2600\uFE0F', value:'diurno'}, right:{emoji:'\uD83C\uDF19', value:'notturno'}},
      {question: 'Stile di vita?', left:{emoji:'\uD83C\uDF89', value:'frenetico'}, right:{emoji:'\uD83E\uDEB9', value:'tranquillo'}},
      {question: 'Coinquilini?', left:{emoji:'\uD83D\uDE10', value:'distaccato'}, right:{emoji:'\uD83E\uDD17', value:'coinvolto'}}
    ];

    const stepsContainer = document.getElementById('stepsContainer');

    stepsData.forEach((step, idx) => {
      const div = document.createElement('div');
      div.className = 'step flex flex-col items-center space-y-4' + (idx ? ' hidden' : '');
      div.innerHTML = `
        <div class="text-center text-lg font-semibold">${step.question}</div>
        <img src="https://via.placeholder.com/80" class="mx-auto" alt="avatar" />
        <div class="flex items-center justify-between w-full gap-4">
          <button class="choice flex-1 py-4 bg-gray-100 rounded text-3xl hover:bg-blue-50" data-value="${step.left.value}">${step.left.emoji}</button>
          <button class="choice flex-1 py-4 bg-gray-100 rounded text-3xl hover:bg-blue-50" data-value="${step.right.value}">${step.right.emoji}</button>
        </div>`;
      stepsContainer.appendChild(div);
    });

    let currentStep = 0;
    updateProgress();

    stepsContainer.addEventListener('click', (e) => {
      if(e.target.classList.contains('choice')) {
        answers.push(e.target.dataset.value);
        nextStep();
      }
    });

    function nextStep() {
      document.querySelectorAll('.step')[currentStep].classList.add('hidden');
      currentStep++;
      if(currentStep < stepsData.length){
        document.querySelectorAll('.step')[currentStep].classList.remove('hidden');
        updateProgress();
      } else {
        formData.autoprofilazione = answers;
        localStorage.setItem('mateForm', JSON.stringify(formData));
        showSummary();
      }
    }

    function updateProgress(){
      const percent = Math.round((currentStep)/(stepsData.length)*100);
      document.getElementById('progressBar').style.width = percent + '%';
      document.getElementById('stepText').textContent = `Step ${currentStep + 1} di ${stepsData.length}`;
      document.getElementById('stepPercent').textContent = percent + '%';
    }

    function showSummary(){
      document.getElementById('stepText').textContent = 'Completato';
      document.getElementById('stepPercent').textContent = '100%';
      document.getElementById('progressBar').style.width = '100%';
      document.getElementById('summaryText').textContent = `Hai scelto uno stile ${answers.join(', ')}!`;
      document.getElementById('summary').classList.remove('hidden');
    }
  });
  </script>
</body>
</html>
